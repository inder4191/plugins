var WEIGHTAGE_KEY="Weightage",RATING_KEY="Rating",MBR_SCORE_ELEM=$("div h2[title='MBR Annual Score']").parent().siblings("div").find("div[class='HRContentCell'] input"),CURRENT_STEP="sfcurrentstep";function getData(){var t=[],E=$("div[class='tabDataBorder']");return $.each(E,function(E,A){var a=$(A).find("table[class='goalDetailsTable']"),_={WEIGHTAGE_KEY:0,RATING_KEY:0};$.each(a,function(t,E){var A=$(E).find("tbody");$.each(A,function(t,E){var A=$(E).find("tr");$.each(A,function(t,E){var A=$(E).find("td[class='lab']").html(),a=$(E).find("td[class='val']").html();switch(A){case WEIGHTAGE_KEY:_.WEIGHTAGE_KEY=parseFloat(a.replace("%",""));break;case RATING_KEY:_.RATING_KEY=parseFloat(a)}})})}),t.push(_)}),t}function actual_score_Calculation(t){var E=0;return t.forEach(t=>{E+=(t.RATING_KEY||t.GOAL_RATING_KEY)*(t.WEIGHTAGE_KEY||t.GOAL_WEIGHTAGE_KEY)/100}),E.toFixed(2)}function calculateScore(t){var E=actual_score_Calculation(t);MBR_SCORE_ELEM.prop("readonly",!0),MBR_SCORE_ELEM.val(E)}function placeRating(){for(var t=[],E=0;E<actual_rating.length;E++)Number(actual_rating[E])===existingRating[E]?t.push("AUTOMATIC"):t.push("MANUAL");var A=t.toString();$("input[type=text]#wf_sect_10_e_ele_30").val(actual_rating.toString()).attr("readonly",!0),$("input[type=text]#wf_sect_10_e_ele_41").val(A).attr("readonly",!0);var a=actual_score_Calculation(Data_Arr);$("input[type=text]#wf_sect_10_e_2").val(a).attr("readonly",!0);var _=$("div h2[title='MBR Annual Score']").parent().siblings("div").find("div[class='HRContentCell']");a===$(_).html()?mbr_status.push("AUTOMATIC"):mbr_status.push("MANUAL"),$("input[type=text]#wf_sect_10_e_ele_23").val(mbr_status.toString()).attr("readonly",!0)}function calculatePositiveRatngWithTarget(t){var E;return t.GOAL_ACHIEVEMENT<t.GOAL_BUDGET?E=0:t.GOAL_ACHIEVEMENT===t.GOAL_BUDGET?E=1:t.GOAL_ACHIEVEMENT===t.GOAL_OUTSTANDING?E=3:t.GOAL_ACHIEVEMENT>=t.GOAL_TARGET_FOR_SCORE?E=4:t.GOAL_ACHIEVEMENT>t.GOAL_BUDGET&&t.GOAL_ACHIEVEMENT<t.GOAL_OUTSTANDING?E=1+(t.GOAL_ACHIEVEMENT-t.GOAL_BUDGET)/(t.GOAL_OUTSTANDING-t.GOAL_BUDGET)*2:t.GOAL_ACHIEVEMENT>t.GOAL_OUTSTANDING&&t.GOAL_ACHIEVEMENT<t.GOAL_TARGET_FOR_SCORE&&(E=3+(t.GOAL_ACHIEVEMENT-t.GOAL_OUTSTANDING)/(t.GOAL_TARGET_FOR_SCORE-t.GOAL_OUTSTANDING)),E.toFixed(2)}function calculateNegativeRatngWithTarget(t){var E;return t.GOAL_ACHIEVEMENT>t.GOAL_BUDGET?E=0:t.GOAL_ACHIEVEMENT===t.GOAL_BUDGET?E=1:t.GOAL_ACHIEVEMENT===t.GOAL_OUTSTANDING?E=3:t.GOAL_ACHIEVEMENT<=t.GOAL_TARGET_FOR_SCORE?E=4:t.GOAL_ACHIEVEMENT<t.GOAL_BUDGET&&t.GOAL_ACHIEVEMENT>t.GOAL_OUTSTANDING?E=1+(t.GOAL_ACHIEVEMENT-t.GOAL_BUDGET)/(t.GOAL_OUTSTANDING-t.GOAL_BUDGET)*2:t.GOAL_ACHIEVEMENT<t.GOAL_OUTSTANDING&&t.GOAL_ACHIEVEMENT>t.GOAL_TARGET_FOR_SCORE&&(E=3+(t.GOAL_ACHIEVEMENT-t.GOAL_OUTSTANDING)/(t.GOAL_TARGET_FOR_SCORE-t.GOAL_OUTSTANDING)),E.toFixed(2)}function calculatePositveRatingWithoutTarget(t){var E;return t.GOAL_ACHIEVEMENT<t.GOAL_BUDGET?E=0:t.GOAL_ACHIEVEMENT===t.GOAL_BUDGET?E=1:t.GOAL_ACHIEVEMENT===t.GOAL_OUTSTANDING?E=3:t.GOAL_ACHIEVEMENT>t.GOAL_OUTSTANDING?E=4:t.GOAL_ACHIEVEMENT>t.GOAL_BUDGET&&t.GOAL_ACHIEVEMENT<t.GOAL_OUTSTANDING&&(E=1+(t.GOAL_ACHIEVEMENT-t.GOAL_BUDGET)/(t.GOAL_OUTSTANDING-t.GOAL_BUDGET)*2),E.toFixed(2)}function calculateNegativeRatingWithoutTarget(t){var E;return t.GOAL_ACHIEVEMENT>t.GOAL_BUDGET?E=0:t.GOAL_ACHIEVEMENT===t.GOAL_BUDGET?E=1:t.GOAL_ACHIEVEMENT===t.GOAL_OUTSTANDING?E=3:t.GOAL_ACHIEVEMENT<t.GOAL_OUTSTANDING?E=4:t.GOAL_ACHIEVEMENT>t.GOAL_OUTSTANDING&&t.GOAL_ACHIEVEMENT<t.GOAL_BUDGET&&(E=1+(t.GOAL_ACHIEVEMENT-t.GOAL_BUDGET)/(t.GOAL_OUTSTANDING-t.GOAL_BUDGET)*2),E.toFixed(2)}function calculate_Rating(t){if(null==t.GOAL_ACHIEVEMENT||isNaN(t.GOAL_ACHIEVEMENT))return"";var E=t.GOAL_OUTSTANDING-t.GOAL_BUDGET;if(t.hasOwnProperty("GOAL_TARGET_FOR_SCORE")&&null!=t.GOAL_TARGET_FOR_SCORE&&!isNaN(t.GOAL_TARGET_FOR_SCORE)){if(console.log(GOAL_TARGET_FOR_SCORE+" : ",t.GOAL_TARGET_FOR_SCORE),E>0)return calculatePositiveRatngWithTarget(t);if(E<0)return calculateNegativeRatngWithTarget(t)}else{if(console.log(GOAL_TARGET_FOR_SCORE+" does not exist or null or NaN : ",t),E>0)return calculatePositveRatingWithoutTarget(t);if(E<0)return calculateNegativeRatingWithoutTarget(t)}}existingRating=[],actual_rating=[],Data_Arr=[],mbr_status=[],$(document).ready(function(){console.log("Already Saved MBR Score :: ",MBR_SCORE_ELEM.val());$("div#routeMap");calculateScore(getData()),Data_Arr=[];for(var t=$(".tabbox"),E=0;E<t.length;E++){var A=$(t[E]).find(".propTable");data={GOAL_BUDGET:"",GOAL_OUTSTANDING:"",GOAL_TARGET_FOR_SCORE:"",GOAL_ACHIEVEMENT:"",GOAL_RATING_KEY:"",GOAL_WEIGHTAGE_KEY:""};for(var a=0;a<A.length;a++){item=A[a];var _=$(item).find(".lab").html(),G=$(item).find(".val").html();if(console.log(_,G),"Budget"===_)data.GOAL_BUDGET=Number(G);else if("Outstanding"===_)data.GOAL_OUTSTANDING=Number(G);else if("Target for a Score of 4 (if applicable)"===_)data.GOAL_TARGET_FOR_SCORE=Number(G);else if("Achievement so far"===_)data.GOAL_ACHIEVEMENT=Number(G);else if("Rating"===_)data.GOAL_RATING_KEY=Number(G);else if("Calculated Rating"===_)existingRating.push(Number(G));else if("Weightage"===_){var e=G.split("%");data.GOAL_WEIGHTAGE_KEY=Number(e[0])}}Data_Arr.push(data);var T=calculate_Rating(data);actual_rating.push(T)}placeRating()});