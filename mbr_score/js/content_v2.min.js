var WEIGHTAGE_KEY="Weightage",RATING_KEY="Rating",annualScoreTitleArray=["MBR Annual Score","Annual Score"],MBR_SCORE_ELEM=$("div h2[title='MBR Annual Score']").parent().siblings("div").find("div[class='HRContentCell'] input"),annual_score_ref=$("div h2[title='MBR Annual Score']").parent().siblings("div").find("div[class='HRContentCell']"),CURRENT_STEP="sfcurrentstep";function getData(){var t=[],a=$("div[class='tabDataBorder']");return $.each(a,function(a,A){var E=$(A).find("table[class='goalDetailsTable']"),_={WEIGHTAGE_KEY:0,RATING_KEY:0};$.each(E,function(t,a){var A=$(a).find("tbody");$.each(A,function(t,a){var A=$(a).find("tr");$.each(A,function(t,a){var A=$(a).find("td[class='lab']").html(),E=$(a).find("td[class='val']").html();switch(A){case WEIGHTAGE_KEY:_.WEIGHTAGE_KEY=parseFloat(E.replace("%",""));break;case RATING_KEY:_.RATING_KEY=parseFloat(E)}})})}),t.push(_)}),t}function actual_score_Calculation(t){var a=0;return t.forEach(t=>{a+=(t.RATING_KEY||t.GOAL_RATING_KEY||0)*(t.WEIGHTAGE_KEY||t.GOAL_WEIGHTAGE_KEY||0)/100}),a.toFixed(2)}function calculateScore(t){var a=actual_score_Calculation(t);MBR_SCORE_ELEM.prop("readonly",!0),MBR_SCORE_ELEM.val(a)}function placeRating(){for(var t=[],a=0;a<actual_rating.length;a++)Number(actual_rating[a])===existingRating[a]?t.push("AUTOMATIC"):t.push("MANUAL");var A=t.toString();$("input[type=text]#wf_sect_10_e_ele_30").val(actual_rating.toString()).attr("readonly",!0),$("input[type=text]#wf_sect_10_e_ele_41").val(A).attr("readonly",!0);var E=actual_score_Calculation(Data_Arr);$("input[type=text]#wf_sect_10_e_2").val(E).attr("readonly",!0),E===$(annual_score_ref).html()?mbr_status.push("AUTOMATIC"):mbr_status.push("MANUAL"),$("input[type=text]#wf_sect_10_e_ele_23").val(mbr_status.toString()).attr("readonly",!0)}function calculatePositiveRatngWithTarget(t){var a;return t.GOAL_ACHIEVEMENT<t.GOAL_BUDGET?a=0:t.GOAL_ACHIEVEMENT===t.GOAL_BUDGET?a=1:t.GOAL_ACHIEVEMENT===t.GOAL_OUTSTANDING?a=3:t.GOAL_ACHIEVEMENT>=t.GOAL_TARGET_FOR_SCORE?a=4:t.GOAL_ACHIEVEMENT>t.GOAL_BUDGET&&t.GOAL_ACHIEVEMENT<t.GOAL_OUTSTANDING?a=1+(t.GOAL_ACHIEVEMENT-t.GOAL_BUDGET)/(t.GOAL_OUTSTANDING-t.GOAL_BUDGET)*2:t.GOAL_ACHIEVEMENT>t.GOAL_OUTSTANDING&&t.GOAL_ACHIEVEMENT<t.GOAL_TARGET_FOR_SCORE&&(a=3+(t.GOAL_ACHIEVEMENT-t.GOAL_OUTSTANDING)/(t.GOAL_TARGET_FOR_SCORE-t.GOAL_OUTSTANDING)),a.toFixed(2)}function calculateNegativeRatngWithTarget(t){var a;return t.GOAL_ACHIEVEMENT>t.GOAL_BUDGET?a=0:t.GOAL_ACHIEVEMENT===t.GOAL_BUDGET?a=1:t.GOAL_ACHIEVEMENT===t.GOAL_OUTSTANDING?a=3:t.GOAL_ACHIEVEMENT<=t.GOAL_TARGET_FOR_SCORE?a=4:t.GOAL_ACHIEVEMENT<t.GOAL_BUDGET&&t.GOAL_ACHIEVEMENT>t.GOAL_OUTSTANDING?a=1+(t.GOAL_ACHIEVEMENT-t.GOAL_BUDGET)/(t.GOAL_OUTSTANDING-t.GOAL_BUDGET)*2:t.GOAL_ACHIEVEMENT<t.GOAL_OUTSTANDING&&t.GOAL_ACHIEVEMENT>t.GOAL_TARGET_FOR_SCORE&&(a=3+(t.GOAL_ACHIEVEMENT-t.GOAL_OUTSTANDING)/(t.GOAL_TARGET_FOR_SCORE-t.GOAL_OUTSTANDING)),a.toFixed(2)}function calculatePositveRatingWithoutTarget(t){var a;return t.GOAL_ACHIEVEMENT<t.GOAL_BUDGET?a=0:t.GOAL_ACHIEVEMENT===t.GOAL_BUDGET?a=1:t.GOAL_ACHIEVEMENT===t.GOAL_OUTSTANDING?a=3:t.GOAL_ACHIEVEMENT>t.GOAL_OUTSTANDING?a=4:t.GOAL_ACHIEVEMENT>t.GOAL_BUDGET&&t.GOAL_ACHIEVEMENT<t.GOAL_OUTSTANDING&&(a=1+(t.GOAL_ACHIEVEMENT-t.GOAL_BUDGET)/(t.GOAL_OUTSTANDING-t.GOAL_BUDGET)*2),a.toFixed(2)}function calculateNegativeRatingWithoutTarget(t){var a;return t.GOAL_ACHIEVEMENT>t.GOAL_BUDGET?a=0:t.GOAL_ACHIEVEMENT===t.GOAL_BUDGET?a=1:t.GOAL_ACHIEVEMENT===t.GOAL_OUTSTANDING?a=3:t.GOAL_ACHIEVEMENT<t.GOAL_OUTSTANDING?a=4:t.GOAL_ACHIEVEMENT>t.GOAL_OUTSTANDING&&t.GOAL_ACHIEVEMENT<t.GOAL_BUDGET&&(a=1+(t.GOAL_ACHIEVEMENT-t.GOAL_BUDGET)/(t.GOAL_OUTSTANDING-t.GOAL_BUDGET)*2),a.toFixed(2)}function calculate_Rating(t){if(!t.GOAL_ACHIEVEMENT||isNaN(t.GOAL_ACHIEVEMENT))return 0;var a=t.GOAL_OUTSTANDING-t.GOAL_BUDGET;if(t.hasOwnProperty("GOAL_TARGET_FOR_SCORE")&&null!=t.GOAL_TARGET_FOR_SCORE&&!isNaN(t.GOAL_TARGET_FOR_SCORE)){if(a>0)return calculatePositiveRatngWithTarget(t);if(a<0)return calculateNegativeRatngWithTarget(t)}else{if(a>0)return calculatePositveRatingWithoutTarget(t);if(a<0)return calculateNegativeRatingWithoutTarget(t)}}function setAnnualAttributeRef(){for(var t=$("div h2"),a=0;a<t.length;a++)annualScoreTitleArray.indexOf($(t[a]).attr("title"))>=0&&(MBR_SCORE_ELEM=$(t[a]).parent().siblings("div").find("div[class='HRContentCell'] input"),annual_score_ref=$(t[a]).parent().siblings("div").find("div[class='HRContentCell']"))}existingRating=[],actual_rating=[],Data_Arr=[],mbr_status=[],$(document).ready(function(){$("div#routeMap");setAnnualAttributeRef(),calculateScore(getData()),Data_Arr=[];for(var t=$(".tabbox"),a=0;a<t.length;a++){var A=$(t[a]).find(".propTable");data={GOAL_BUDGET:"",GOAL_OUTSTANDING:"",GOAL_TARGET_FOR_SCORE:"",GOAL_ACHIEVEMENT:"",GOAL_RATING_KEY:"",GOAL_WEIGHTAGE_KEY:""};for(var E=0;E<A.length;E++){item=A[E];var _=$(item).find(".lab").html(),e=$(item).find(".val").html();if("Budget"===_)data.GOAL_BUDGET=Number(e)||0;else if("Outstanding"===_)data.GOAL_OUTSTANDING=Number(e)||0;else if("Target for a Score of 4(if applicable)"===_)data.GOAL_TARGET_FOR_SCORE=Number(e)||0;else if("Achievement so far"===_)data.GOAL_ACHIEVEMENT=Number(e)||0;else if("Rating"===_)data.GOAL_RATING_KEY=Number(e)||0;else if("Calculated Rating"===_)existingRating.push(Number(e)||0);else if("Weightage"===_){var G=e.split("%");data.GOAL_WEIGHTAGE_KEY=Number(G[0])||0}}Data_Arr.push(data);var T=calculate_Rating(data);actual_rating.push(T)}placeRating()});